# Sessions: 2026-01-13

**Summary:** Claude CLI PRD/Task creation + quota fix

---

## Session 1: Claude CLI Integration for PRD/Task Creation

**Duration:** ~2 hours
**Status:** Complete

### What was done

1. **Replaced VS Code input boxes with Claude CLI for PRD/Task creation**
   - `kaiban.createPRD` now opens Claude CLI terminal with interactive prompts
   - `kaiban.createTask` now opens Claude CLI terminal with interactive prompts
   - Claude asks questions, generates content, writes files directly
   - File watcher auto-refreshes board when files appear

2. **Fixed Claude CLI quota display bug**
   - API returns `snake_case` keys (`five_hour`, `resets_at`)
   - Code expected `camelCase` (`fiveHour`, `resetsAt`)
   - Updated types and service to match API format
   - Quota now displays correctly in UI

3. **Test cleanup**
   - Fixed flaky `renderMarkdown` tests that were failing due to mock call ordering
   - All 138 tests passing

### Files changed

- `src/extension.ts` - Replaced createPRD/createTask with Claude CLI approach
  - Removed imports: `generateSimplePRDTemplate`, `generateSimpleTaskTemplate`, `slugify`, `createFile`, `ensureDirectoryExists`, `generateUniqueFileName`
  - `createPRD`: Opens Claude CLI with prompt to interactively create PRD
  - `createTask`: Opens Claude CLI with prompt to interactively create task

- `src/types/claudeQuota.ts` - Fixed API response type
  - Changed `ClaudeCodeUsageResponse` to use `snake_case` keys
  - Updated utilization comment (0-100+, not 0.0-1.0)
  - Updated `getQuotaStatus()` thresholds (90, 80 instead of 0.9, 0.8)

- `src/services/claudeCodeQuotaService.ts` - Fixed API mapping
  - Changed `data.fiveHour` → `data.five_hour`
  - Changed `data.fiveHour.resetsAt` → `data.five_hour.resets_at`
  - Same for `sevenDay` and `sevenDaySonnet`

- `src/kanbanView.test.ts` - Fixed flaky tests
  - Added `mockClear()` in `renderMarkdown` tests `beforeEach`
  - Changed test assertions to search for `updatePRDContent` message instead of assuming first call

### Decisions

- **Decision:** Use Claude CLI for PRD/Task creation instead of VS Code input boxes
  - **Context:** User wanted consistency with task execution workflow
  - **Rationale:** Claude can ask follow-up questions, clarify requirements, and generate better content interactively. Keeps workflow consistent with existing task execution via Claude CLI.

- **Decision:** Claude writes files directly, not using templates
  - **Context:** Previously used `generateSimplePRDTemplate` and `generateSimpleTaskTemplate`
  - **Rationale:** Claude generates better, more contextual content by asking questions. Templates are too rigid.

- **Decision:** Fixed quota API to use snake_case
  - **Context:** API returns `five_hour` but code expected `fiveHour`
  - **Rationale:** Match API format exactly to avoid parsing errors

### Next steps

- Test the PRD/Task creation workflow in the extension
- Verify quota displays correctly after reload
- Consider adding file watcher notification when new PRD/Task is created

---

## Session 2: GitHub Social Preview Image

**Duration:** ~15 minutes
**Status:** Complete

### What was done

1. **Created GitHub social preview image for Kaiban Board**
   - Initial version: Light background, centered layout (GitHub template style)
   - Final version: Dark theme matching Quota Guard style
   - Two-column layout: branding left, product preview right

2. **Design elements**
   - Left side: Icon, "Kaiban Board" title, description, badges (VS Code, Claude CLI, Markdown)
   - Right side: 3-column kanban board preview (To Do, Doing, Done)
   - Visual cues: Play button on active task, green checkmarks on completed, priority badges
   - Dark background with subtle purple glow matching brand colors

### Files created

- `assets/social-preview.svg` - Vector source file (1280x640)
- `assets/social-preview.png` - PNG export for GitHub (1280x640)

### Decisions

- **Decision:** Use Quota Guard style instead of GitHub template
  - **Context:** User preferred cleaner two-column layout with dark theme
  - **Rationale:** Better visual hierarchy, more breathing room, shows product UI preview

- **Decision:** Simplified kanban to 3 columns (To Do, Doing, Done)
  - **Context:** Original had more columns taking up too much space
  - **Rationale:** Cleaner representation, easier to read at social preview sizes

### Tools used

- `rsvg-convert` for SVG to PNG conversion

---

**Total sessions today:** 2
